<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeatForge AI - Professional Digital Audio Workstation</title>
    <meta name="description" content="Advanced DAW with AI session assistant, frequency analysis, and intelligent arrangement tools">
    <style>
        /* Complete CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-muted: #6b6b6b;
            --border-color: #333333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .loading-content {
            text-align: center;
        }

        .waveform-bars {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4px;
            height: 60px;
            margin-bottom: 2rem;
        }

        .waveform-bars .bar {
            width: 6px;
            background: linear-gradient(to top, var(--accent-primary), var(--accent-secondary));
            border-radius: 3px;
            animation: wave 1.2s ease-in-out infinite;
        }

        .waveform-bars .bar:nth-child(1) { animation-delay: 0s; height: 20px; }
        .waveform-bars .bar:nth-child(2) { animation-delay: 0.1s; height: 35px; }
        .waveform-bars .bar:nth-child(3) { animation-delay: 0.2s; height: 50px; }
        .waveform-bars .bar:nth-child(4) { animation-delay: 0.3s; height: 35px; }
        .waveform-bars .bar:nth-child(5) { animation-delay: 0.4s; height: 20px; }

        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.5); }
        }

        .loading-content h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .loading-content p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .daw-interface {
            display: none;
            min-height: 100vh;
            background: var(--bg-primary);
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .top-nav {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .main-nav {
            display: flex;
            gap: 0.5rem;
        }

        .nav-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .nav-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .transport-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem;
            border: 1px solid var(--border-color);
        }

        .transport-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .transport-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .transport-btn:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            transform: scale(1.05);
        }

        .transport-btn.playing {
            background: var(--accent-success);
            border-color: var(--accent-success);
        }

        .transport-btn.record-btn.recording {
            background: var(--accent-danger);
            border-color: var(--accent-danger);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .time-display {
            text-align: center;
            margin-bottom: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            color: var(--text-primary);
        }

        .separator {
            color: var(--text-muted);
            margin: 0 0.5rem;
        }

        .playback-info {
            display: flex;
            justify-content: center;
            gap: 2rem;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-item label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .info-item select {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .tempo-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tempo-control label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .tempo-control input {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            width: 60px;
        }

        .ai-assistant-toggle {
            background: var(--accent-secondary);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .ai-assistant-toggle:hover {
            background: var(--accent-primary);
        }

        /* Section Styles */
        .section-content {
            display: none;
            padding: 1rem;
        }

        .section-content.active {
            display: block;
        }

        /* Session View */
        .session-view {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem;
            border: 1px solid var(--border-color);
        }

        .tracks-container {
            margin-bottom: 1rem;
        }

        .track {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border: 1px solid var(--border-color);
        }

        .track-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .track-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .track-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .track-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .track-controls {
            display: flex;
            gap: 0.5rem;
        }

        .track-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            width: 30px;
            height: 30px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .track-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .track-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .track-timeline {
            background: var(--bg-primary);
            height: 60px;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .track-clips {
            display: flex;
            align-items: center;
            height: 100%;
            padding: 0.5rem;
            gap: 0.5rem;
        }

        .clip {
            background: var(--accent-primary);
            height: 40px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: 500;
            padding: 0 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clip:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
        }

        /* AI Assistant */
        .ai-assistant-panel {
            background: var(--bg-secondary);
            border-radius: 12px;
            margin: 1rem;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .ai-header {
            background: var(--bg-tertiary);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .ai-header h3 {
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .ai-controls {
            display: flex;
            gap: 0.5rem;
        }

        .ai-analyze-btn {
            background: var(--accent-primary);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .ai-analyze-btn:hover {
            background: var(--accent-secondary);
        }

        .ai-content {
            padding: 1.5rem;
        }

        .ai-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .ai-tab {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            font-size: 0.9rem;
        }

        .ai-tab:hover {
            color: var(--text-primary);
        }

        .ai-tab.active {
            color: var(--accent-primary);
            border-bottom-color: var(--accent-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .frequency-meters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .freq-meter {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .meter-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .meter-bar {
            height: 40px;
            background: var(--bg-primary);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
            position: relative;
        }

        .meter-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            transition: height 0.3s ease;
        }

        .meter-fill.green { background: var(--accent-success); }
        .meter-fill.yellow { background: var(--accent-warning); }
        .meter-fill.red { background: var(--accent-danger); }

        .suggestion-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .suggestion-item {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .suggestion-type {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .suggestion-desc {
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .apply-btn {
            background: var(--accent-primary);
            border: none;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .apply-btn:hover {
            background: var(--accent-secondary);
        }

        /* Mixer View */
        .mixer-view {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem;
            border: 1px solid var(--border-color);
        }

        .mixer-channels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .channel {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .channel-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .vu-meter {
            height: 100px;
            background: var(--bg-primary);
            border-radius: 4px;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .vu-meter-left,
        .vu-meter-right {
            position: absolute;
            bottom: 0;
            width: 50%;
            height: 0%;
            transition: height 0.1s ease;
        }

        .vu-meter-left {
            left: 0;
            background: linear-gradient(to top, var(--accent-success), var(--accent-warning), var(--accent-danger));
        }

        .vu-meter-right {
            right: 0;
            background: linear-gradient(to top, var(--accent-success), var(--accent-warning), var(--accent-danger));
        }

        .volume-fader {
            margin-bottom: 1rem;
        }

        .fader {
            width: 100%;
            height: 4px;
            background: var(--bg-primary);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .fader::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent-primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .fader::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--accent-primary);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .channel-controls {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .channel-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            width: 25px;
            height: 25px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.7rem;
        }

        .channel-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .channel-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        /* Plugins View */
        .plugins-view {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem;
            border: 1px solid var(--border-color);
        }

        .plugins-rack {
            display: grid;
            gap: 1rem;
        }

        .plugin-slot {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid var(--border-color);
        }

        .plugin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .plugin-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .plugin-toggle {
            background: var(--accent-primary);
            border: none;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .plugin-toggle:hover {
            background: var(--accent-secondary);
        }

        .plugin-toggle.bypassed {
            background: var(--text-muted);
        }

        .plugin-controls {
            display: grid;
            gap: 0.75rem;
        }

        .control-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .control-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .control-slider {
            width: 120px;
            height: 4px;
            background: var(--bg-primary);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: var(--accent-primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .control-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: var(--accent-primary);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .control-value {
            font-size: 0.8rem;
            color: var(--text-primary);
            min-width: 40px;
            text-align: right;
        }

        /* Export View */
        .export-view {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem;
            border: 1px solid var(--border-color);
        }

        .export-options {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .export-group {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid var(--border-color);
        }

        .export-group h4 {
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .format-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.5rem;
        }

        .format-option {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
        }

        .format-option:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .format-option.selected {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .export-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .export-btn {
            background: var(--accent-success);
            border: none;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .export-btn:hover {
            background: var(--accent-primary);
        }

        .cancel-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.75rem 2rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .cancel-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .top-nav {
                padding: 1rem;
            }
            .nav-left {
                flex-direction: column;
                gap: 1rem;
            }
            .transport-controls {
                gap: 0.5rem;
            }
            .transport-btn {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            .time-display {
                font-size: 1rem;
            }
            .playback-info {
                flex-direction: column;
                gap: 1rem;
            }
            .frequency-meters {
                grid-template-columns: 1fr;
            }
            .mixer-channels {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
            .format-options {
                grid-template-columns: 1fr 1fr;
            }
            .export-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="waveform-bars">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <h1>BeatForge AI</h1>
            <p>Initializing Audio Engine...</p>
        </div>
    </div>

    <!-- Main DAW Interface -->
    <div id="daw-interface" class="daw-interface">
        <header class="top-nav">
            <div class="nav-left">
                <div class="logo">
                    <div class="logo-icon">üéµ</div>
                    <h1>BeatForge AI</h1>
                </div>
                <nav class="main-nav">
                    <button class="nav-btn active" data-section="session">Session</button>
                    <button class="nav-btn" data-section="ai">AI Assistant</button>
                    <button class="nav-btn" data-section="mixer">Mixer</button>
                    <button class="nav-btn" data-section="plugins">Plugins</button>
                    <button class="nav-btn" data-section="export">Export</button>
                </nav>
            </div>
            <div class="nav-right">
                <div class="tempo-control">
                    <label>BPM</label>
                    <input type="number" id="bpm-input" value="120" min="60" max="200">
                </div>
                <button class="ai-assistant-toggle" id="ai-toggle">
                    <span class="ai-icon">ü§ñ</span>
                    <span>AI Assistant</span>
                </button>
            </div>
        </header>

        <!-- Transport Controls -->
        <section class="transport-section">
            <div class="transport-controls">
                <button class="transport-btn" id="rewind-btn">‚èÆÔ∏è</button>
                <button class="transport-btn" id="play-btn">‚ñ∂Ô∏è</button>
                <button class="transport-btn" id="stop-btn">‚èπÔ∏è</button>
                <button class="transport-btn record-btn" id="record-btn">‚è∫Ô∏è</button>
                <button class="transport-btn" id="loop-btn">üîÅ</button>
            </div>
            <div class="time-display">
                <span id="current-time">00:00:00.000</span>
                <span class="separator">/</span>
                <span id="total-time">00:03:45.000</span>
            </div>
            <div class="playback-info">
                <div class="info-item">
                    <label>Key</label>
                    <select id="key-select">
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                    </select>
                </div>
                <div class="info-item">
                    <label>Time Sig</label>
                    <select id="time-sig">
                        <option value="4/4">4/4</option>
                        <option value="3/4">3/4</option>
                        <option value="6/8">6/8</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Session View -->
        <section class="session-view section-content active" id="session-section">
            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">üéµ Session Tracks</h3>
            <div class="tracks-container">
                <div class="track">
                    <div class="track-header">
                        <div class="track-info">
                            <div class="track-color" style="background: #ef4444;"></div>
                            <div class="track-name">Drums</div>
                        </div>
                        <div class="track-controls">
                            <button class="track-btn">M</button>
                            <button class="track-btn">S</button>
                            <button class="track-btn">R</button>
                        </div>
                    </div>
                    <div class="track-timeline">
                        <div class="track-clips">
                            <div class="clip">Kick Pattern</div>
                            <div class="clip">Snare Pattern</div>
                            <div class="clip">Hi-Hats</div>
                        </div>
                    </div>
                </div>
                <div class="track">
                    <div class="track-header">
                        <div class="track-info">
                            <div class="track-color" style="background: #f59e0b;"></div>
                            <div class="track-name">Bass</div>
                        </div>
                        <div class="track-controls">
                            <button class="track-btn">M</button>
                            <button class="track-btn">S</button>
                            <button class="track-btn">R</button>
                        </div>
                    </div>
                    <div class="track-timeline">
                        <div class="track-clips">
                            <div class="clip">Bassline</div>
                            <div class="clip">Sub Bass</div>
                        </div>
                    </div>
                </div>
                <div class="track">
                    <div class="track-header">
                        <div class="track-info">
                            <div class="track-color" style="background: #10b981;"></div>
                            <div class="track-name">Synth Lead</div>
                        </div>
                        <div class="track-controls">
                            <button class="track-btn">M</button>
                            <button class="track-btn">S</button>
                            <button class="track-btn">R</button>
                        </div>
                    </div>
                    <div class="track-timeline">
                        <div class="track-clips">
                            <div class="clip">Main Melody</div>
                            <div class="clip">Arpeggio</div>
                        </div>
                    </div>
                </div>
                <div class="track">
                    <div class="track-header">
                        <div class="track-info">
                            <div class="track-color" style="background: #3b82f6;"></div>
                            <div class="track-name">Vocals</div>
                        </div>
                        <div class="track-controls">
                            <button class="track-btn">M</button>
                            <button class="track-btn">S</button>
                            <button class="track-btn">R</button>
                        </div>
                    </div>
                    <div class="track-timeline">
                        <div class="track-clips">
                            <div class="clip">Lead Vocal</div>
                            <div class="clip">Backing Vocals</div>
                        </div>
                    </div>
                </div>
                <div class="track">
                    <div class="track-header">
                        <div class="track-info">
                            <div class="track-color" style="background: #8b5cf6;"></div>
                            <div class="track-name">Ambient Pad</div>
                        </div>
                        <div class="track-controls">
                            <button class="track-btn">M</button>
                            <button class="track-btn">S</button>
                            <button class="track-btn">R</button>
                        </div>
                    </div>
                    <div class="track-timeline">
                        <div class="track-clips">
                            <div class="clip">Atmosphere</div>
                            <div class="clip">Texture</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI Assistant View -->
        <section class="ai-assistant-panel section-content" id="ai-section">
            <div class="ai-header">
                <h3>ü§ñ AI Session Assistant</h3>
                <div class="ai-controls">
                    <button class="ai-analyze-btn" id="analyze-session">Analyze Session</button>
                </div>
            </div>
            
            <div class="ai-content">
                <div class="ai-tabs">
                    <button class="ai-tab active" data-tab="frequency">Frequency Analysis</button>
                    <button class="ai-tab" data-tab="suggestions">Suggestions</button>
                    <button class="ai-tab" data-tab="arrangement">Arrangement</button>
                </div>

                <!-- Frequency Analysis Tab -->
                <div class="tab-content active" id="frequency-tab">
                    <h4 style="margin-bottom: 1rem;">üéõÔ∏è Clashing Frequency Detection</h4>
                    <div class="frequency-meters">
                        <div class="freq-meter">
                            <div class="meter-label">Sub Bass (20-60Hz)</div>
                            <div class="meter-bar">
                                <div class="meter-fill green" style="height: 40%"></div>
                            </div>
                        </div>
                        <div class="freq-meter">
                            <div class="meter-label">Bass (60-250Hz)</div>
                            <div class="meter-bar">
                                <div class="meter-fill yellow" style="height: 75%"></div>
                            </div>
                        </div>
                        <div class="freq-meter">
                            <div class="meter-label">Mid (500-2kHz)</div>
                            <div class="meter-bar">
                                <div class="meter-fill red" style="height: 90%"></div>
                            </div>
                        </div>
                        <div class="freq-meter">
                            <div class="meter-label">High (2-6kHz)</div>
                            <div class="meter-bar">
                                <div class="meter-fill yellow" style="height: 60%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Suggestions Tab -->
                <div class="tab-content" id="suggestions-tab">
                    <h4 style="margin-bottom: 1rem;">üí° Intelligent Suggestions</h4>
                    <div class="suggestion-list">
                        <div class="suggestion-item">
                            <span class="suggestion-type">Drum Fill</span>
                            <span class="suggestion-desc">Add 1/4 note triplet fill before chorus</span>
                            <button class="apply-btn">Apply</button>
                        </div>
                        <div class="suggestion-item">
                            <span class="suggestion-type">Riser</span>
                            <span class="suggestion-desc">8-bar noise riser leading to drop</span>
                            <button class="apply-btn">Apply</button>
                        </div>
                        <div class="suggestion-item">
                            <span class="suggestion-type">EQ</span>
                            <span class="suggestion-desc">Subtle 2dB boost at 80Hz</span>
                            <button class="apply-btn">Apply</button>
                        </div>
                    </div>
                </div>

                <!-- Arrangement Tab -->
                <div class="tab-content" id="arrangement-tab">
                    <h4 style="margin-bottom: 1rem;">üéº Arrangement Analysis</h4>
                    <div style="color: var(--text-secondary);">
                        <p>Current Structure: Intro ‚Üí Verse ‚Üí Chorus ‚Üí Verse ‚Üí Chorus ‚Üí Bridge ‚Üí Chorus ‚Üí Outro</p>
                        <p style="margin-top: 1rem;">üí° Consider adding a pre-chorus before second verse for better flow.</p>
                        <p>üî• The chorus could benefit from an additional counter-melody.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mixer View -->
        <section class="mixer-view section-content" id="mixer-section">
            <h3 style="margin-bottom: 1rem;">üéöÔ∏è Mixer</h3>
            <div class="mixer-channels">
                <div class="channel">
                    <div class="channel-name">Drums</div>
                    <div class="vu-meter">
                        <div class="vu-meter-left" style="height: 60%;"></div>
                        <div class="vu-meter-right" style="height: 55%;"></div>
                    </div>
                    <div class="volume-fader">
                        <input type="range" class="fader" min="0" max="100" value="75">
                    </div>
                    <div class="channel-controls">
                        <button class="channel-btn">M</button>
                        <button class="channel-btn">S</button>
                        <button class="channel-btn">R</button>
                    </div>
                </div>
                <div class="channel">
                    <div class="channel-name">Bass</div>
                    <div class="vu-meter">
                        <div class="vu-meter-left" style="height: 70%;"></div>
                        <div class="vu-meter-right" style="height: 65%;"></div>
                    </div>
                    <div class="volume-fader">
                        <input type="range" class="fader" min="0" max="100" value="70">
                    </div>
                    <div class="channel-controls">
                        <button class="channel-btn">M</button>
                        <button class="channel-btn">S</button>
                        <button class="channel-btn">R</button>
                    </div>
                </div>
                <div class="channel">
                    <div class="channel-name">Synth Lead</div>
                    <div class="vu-meter">
                        <div class="vu-meter-left" style="height: 45%;"></div>
                        <div class="vu-meter-right" style="height: 40%;"></div>
                    </div>
                    <div class="volume-fader">
                        <input type="range" class="fader" min="0" max="100" value="65">
                    </div>
                    <div class="channel-controls">
                        <button class="channel-btn">M</button>
                        <button class="channel-btn">S</button>
                        <button class="channel-btn">R</button>
                    </div>
                </div>
                <div class="channel">
                    <div class="channel-name">Vocals</div>
                    <div class="vu-meter">
                        <div class="vu-meter-left" style="height: 80%;"></div>
                        <div class="vu-meter-right" style="height: 75%;"></div>
                    </div>
                    <div class="volume-fader">
                        <input type="range" class="fader" min="0" max="100" value="80">
                    </div>
                    <div class="channel-controls">
                        <button class="channel-btn">M</button>
                        <button class="channel-btn">S</button>
                        <button class="channel-btn">R</button>
                    </div>
                </div>
                <div class="channel">
                    <div class="channel-name">Ambient Pad</div>
                    <div class="vu-meter">
                        <div class="vu-meter-left" style="height: 30%;"></div>
                        <div class="vu-meter-right" style="height: 25%;"></div>
                    </div>
                    <div class="volume-fader">
                        <input type="range" class="fader" min="0" max="100" value="50">
                    </div>
                    <div class="channel-controls">
                        <button class="channel-btn">M</button>
                        <button class="channel-btn">S</button>
                        <button class="channel-btn">R</button>
                    </div>
                </div>
                <div class="channel">
                    <div class="channel-name">Master</div>
                    <div class="vu-meter">
                        <div class="vu-meter-left" style="height: 85%;"></div>
                        <div class="vu-meter-right" style="height: 82%;"></div>
                    </div>
                    <div class="volume-fader">
                        <input type="range" class="fader" min="0" max="100" value="100">
                    </div>
                    <div class="channel-controls">
                        <button class="channel-btn">M</button>
                        <button class="channel-btn">S</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Plugins View -->
        <section class="plugins-view section-content" id="plugins-section">
            <h3 style="margin-bottom: 1rem;">üîå Plugin Rack</h3>
            <div class="plugins-rack">
                <div class="plugin-slot">
                    <div class="plugin-header">
                        <div class="plugin-name">EQ</div>
                        <button class="plugin-toggle">ON</button>
                    </div>
                    <div class="plugin-controls">
                        <div class="control-group">
                            <span class="control-label">Low</span>
                            <input type="range" class="control-slider" min="-20" max="20" value="0">
                            <span class="control-value">0dB</span>
                        </div>
                        <div class="control-group">
                            <span class="control-label">Mid</span>
                            <input type="range" class="control-slider" min="-20" max="20" value="0">
                            <span class="control-value">0dB</span>
                        </div>
                        <div class="control-group">
                            <span class="control-label">High</span>
                            <input type="range" class="control-slider" min="-20" max="20" value="0">
                            <span class="control-value">0dB</span>
                        </div>
                    </div>
                </div>
                <div class="plugin-slot">
                    <div class="plugin-header">
                        <div class="plugin-name">Compressor</div>
                        <button class="plugin-toggle">ON</button>
                    </div>
                    <div class="plugin-controls">
                        <div class="control-group">
                            <span class="control-label">Threshold</span>
                            <input type="range" class="control-slider" min="-60" max="0" value="-20">
                            <span class="control-value">-20dB</span>
                        </div>
                        <div class="control-group">
                            <span class="control-label">Ratio</span>
                            <input type="range" class="control-slider" min="1" max="20" value="4">
                            <span class="control-value">4:1</span>
                        </div>
                        <div class="control-group">
                            <span class="control-label">Attack</span>
                            <input type="range" class="control-slider" min="0" max="100" value="2">
                            <span class="control-value">2ms</span>
                        </div>
                    </div>
                </div>
                <div class="plugin-slot">
                    <div class="plugin-header">
                        <div class="plugin-name">Reverb</div>
                        <button class="plugin-toggle">ON</button>
                    </div>
                    <div class="plugin-controls">
                        <div class="control-group">
                            <span class="control-label">Room Size</span>
                            <input type="range" class="control-slider" min="0" max="100" value="30">
                            <span class="control-value">30%</span>
                        </div>
                        <div class="control-group">
                            <span class="control-label">Damping</span>
                            <input type="range" class="control-slider" min="0" max="100" value="50">
                            <span class="control-value">50%</span>
                        </div>
                        <div class="control-group">
                            <span class="control-label">Wet Mix</span>
                            <input type="range" class="control-slider" min="0" max="100" value="20">
                            <span class="control-value">20%</span>
                        </div>
                    </div>
                </div>
                <div class="plugin-slot">
                    <div class="plugin-header">
                        <div class="plugin-name">Limiter</div>
                        <button class="plugin-toggle">ON</button>
                    </div>
                    <div class="plugin-controls">
                        <div class="control-group">
                            <span class="control-label">Ceiling</span>
                            <input type="range" class="control-slider" min="-6" max="0" value="-1">
                            <span class="control-value">-1dB</span>
                        </div>
                        <div class="control-group">
                            <span class="control-label">Release</span>
                            <input type="range" class="control-slider" min="1" max="100" value="10">
                            <span class="control-value">10ms</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Export View -->
        <section class="export-view section-content" id="export-section">
            <h3 style="margin-bottom: 1rem;">üì§ Export Project</h3>
            <div class="export-options">
                <div class="export-group">
                    <h4>Format</h4>
                    <div class="format-options">
                        <div class="format-option selected" data-format="wav">WAV</div>
                        <div class="format-option" data-format="mp3">MP3</div>
                        <div class="format-option" data-format="flac">FLAC</div>
                        <div class="format-option" data-format="ogg">OGG</div>
                    </div>
                </div>
                <div class="export-group">
                    <h4>Quality Settings</h4>
                    <div style="display: grid; gap: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.9rem; color: var(--text-secondary);">Sample Rate</span>
                            <input type="range" style="width: 150px; height: 4px; background: var(--bg-primary); border-radius: 2px; outline: none; -webkit-appearance: none;" min="44100" max="192000" value="44100">
                            <span style="font-size: 0.8rem; color: var(--text-primary); min-width: 50px; text-align: right;">44.1kHz</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.9rem; color: var(--text-secondary);">Bit Depth</span>
                            <input type="range" style="width: 150px; height: 4px; background: var(--bg-primary); border-radius: 2px; outline: none; -webkit-appearance: none;" min="16" max="32" value="24">
                            <span style="font-size: 0.8rem; color: var(--text-primary); min-width: 50px; text-align: right;">24-bit</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="export-actions">
                <button class="export-btn" id="export-start">üì§ Export</button>
                <button class="cancel-btn" id="export-cancel">Cancel</button>
            </div>
        </section>
    </div>

    <script>
        // Complete DAW JavaScript with Realistic Mixer
        class BeatForgeAI {
            constructor() {
                this.isPlaying = false;
                this.isRecording = false;
                this.isLooping = false;
                this.currentTime = 0;
                this.totalTime = 225; // 3:45 in seconds
                this.bpm = 120;
                this.vuAnimationInterval = null;
                
                this.initializeElements();
                this.hideLoadingScreen();
                this.initializeEventListeners();
                this.startAnimationLoop();
                console.log('BeatForge AI DAW initialized successfully!');
            }

            hideLoadingScreen() {
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loading-screen');
                    const dawInterface = document.getElementById('daw-interface');
                    
                    if (loadingScreen) {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                        }, 500);
                    }
                    
                    if (dawInterface) {
                        dawInterface.style.display = 'block';
                        setTimeout(() => {
                            dawInterface.style.opacity = '1';
                        }, 100);
                    }
                }, 2000);
            }

            initializeElements() {
                this.playBtn = document.getElementById('play-btn');
                this.stopBtn = document.getElementById('stop-btn');
                this.recordBtn = document.getElementById('record-btn');
                this.loopBtn = document.getElementById('loop-btn');
                this.rewindBtn = document.getElementById('rewind-btn');
                this.currentTimeDisplay = document.getElementById('current-time');
                this.totalTimeDisplay = document.getElementById('total-time');
                this.loadingScreen = document.getElementById('loading-screen');
                this.dawInterface = document.getElementById('daw-interface');
            }

            initializeEventListeners() {
                // Transport controls
                if (this.playBtn) this.playBtn.addEventListener('click', () => this.togglePlayback());
                if (this.stopBtn) this.stopBtn.addEventListener('click', () => this.stop());
                if (this.recordBtn) this.recordBtn.addEventListener('click', () => this.toggleRecording());
                if (this.loopBtn) this.loopBtn.addEventListener('click', () => this.toggleLoop());
                if (this.rewindBtn) this.rewindBtn.addEventListener('click', () => this.rewind());

                // Navigation
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.switchSection(e.target.dataset.section));
                });

                // AI Assistant
                document.getElementById('analyze-session')?.addEventListener('click', () => this.analyzeSession());

                // AI Tabs
                document.querySelectorAll('.ai-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchAITab(e.target.dataset.tab));
                });

                // Track controls
                document.querySelectorAll('.track-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.toggleTrackControl(e.target));
                });

                // Channel controls
                document.querySelectorAll('.channel-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.toggleChannelControl(e.target));
                });

                // Plugin toggles
                document.querySelectorAll('.plugin-toggle').forEach(btn => {
                    btn.addEventListener('click', (e) => this.togglePlugin(e.target));
                });

                // Format options
                document.querySelectorAll('.format-option').forEach(btn => {
                    btn.addEventListener('click', (e) => this.selectFormat(e.target));
                });

                // Export controls
                document.getElementById('export-start')?.addEventListener('click', () => this.startExport());
                document.getElementById('export-cancel')?.addEventListener('click', () => this.cancelExport());

                // Control sliders
                document.querySelectorAll('.control-slider, .fader').forEach(slider => {
                    slider.addEventListener('input', (e) => this.updateControlValue(e.target));
                });

                // BPM control
                const bpmInput = document.getElementById('bpm-input');
                if (bpmInput) {
                    bpmInput.addEventListener('change', (e) => {
                        this.bpm = parseInt(e.target.value);
                        console.log('BPM changed to:', this.bpm);
                    });
                }
            }

            togglePlayback() {
                if (this.isPlaying) {
                    this.pause();
                } else {
                    this.play();
                }
            }

            play() {
                this.isPlaying = true;
                if (this.playBtn) {
                    this.playBtn.innerHTML = '‚è∏Ô∏è';
                    this.playBtn.classList.add('playing');
                }
                this.startPlaybackTimer();
                this.startVUAnimation();
                console.log('Playback started');
            }

            pause() {
                this.isPlaying = false;
                if (this.playBtn) {
                    this.playBtn.innerHTML = '‚ñ∂Ô∏è';
                    this.playBtn.classList.remove('playing');
                }
                this.stopPlaybackTimer();
                this.stopVUAnimation();
                console.log('Playback paused');
            }

            stop() {
                this.isPlaying = false;
                this.currentTime = 0;
                if (this.playBtn) {
                    this.playBtn.innerHTML = '‚ñ∂Ô∏è';
                    this.playBtn.classList.remove('playing');
                }
                this.stopPlaybackTimer();
                this.stopVUAnimation();
                this.updateTimeDisplay();
                console.log('Playback stopped');
            }

            toggleRecording() {
                this.isRecording = !this.isRecording;
                if (this.recordBtn) {
                    if (this.isRecording) {
                        this.recordBtn.classList.add('recording');
                        console.log('Recording started');
                    } else {
                        this.recordBtn.classList.remove('recording');
                        console.log('Recording stopped');
                    }
                }
            }

            toggleLoop() {
                this.isLooping = !this.isLooping;
                if (this.loopBtn) {
                    if (this.isLooping) {
                        this.loopBtn.classList.add('active');
                    } else {
                        this.loopBtn.classList.remove('active');
                    }
                }
                console.log('Loop toggled:', this.isLooping);
            }

            rewind() {
                this.currentTime = 0;
                this.updateTimeDisplay();
                console.log('Rewound to start');
            }

            startPlaybackTimer() {
                this.playbackTimer = setInterval(() => {
                    if (this.isPlaying) {
                        this.currentTime += 0.1;
                        if (this.currentTime >= this.totalTime) {
                            if (this.isLooping) {
                                this.currentTime = 0;
                            } else {
                                this.stop();
                            }
                        }
                        this.updateTimeDisplay();
                    }
                }, 100);
            }

            stopPlaybackTimer() {
                if (this.playbackTimer) {
                    clearInterval(this.playbackTimer);
                    this.playbackTimer = null;
                }
            }

            updateTimeDisplay() {
                if (this.currentTimeDisplay) {
                    this.currentTimeDisplay.textContent = this.formatTime(this.currentTime);
                }
                if (this.totalTimeDisplay) {
                    this.totalTimeDisplay.textContent = this.formatTime(this.totalTime);
                }
            }

            formatTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);
                const ms = Math.floor((seconds % 1) * 1000);
                
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}.${ms.toString().padStart(3, '0')}`;
            }

            switchSection(sectionName) {
                console.log('Switching to section:', sectionName);
                
                // Update nav buttons
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-section="${sectionName}"]`)?.classList.add('active');
                
                // Hide all sections
                document.querySelectorAll('.section-content').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show selected section
                document.getElementById(`${sectionName}-section`)?.classList.add('active');
            }

            switchAITab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.ai-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`)?.classList.add('active');
                
                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}-tab`)?.classList.add('active');
            }

            analyzeSession() {
                const analyzeBtn = document.getElementById('analyze-session');
                if (analyzeBtn) {
                    analyzeBtn.textContent = 'üîÑ Analyzing...';
                    analyzeBtn.disabled = true;
                    
                    setTimeout(() => {
                        analyzeBtn.textContent = 'üîç Analyze Session';
                        analyzeBtn.disabled = false;
                        this.showNotification('Session analysis complete! No frequency clashes detected.', 'success');
                    }, 2000);
                }
            }

            toggleTrackControl(button) {
                button.classList.toggle('active');
                const track = button.closest('.track');
                const trackName = track.querySelector('.track-name').textContent;
                const action = button.textContent;
                console.log(`${trackName} ${action} toggled`);
            }

            toggleChannelControl(button) {
                button.classList.toggle('active');
                const channel = button.closest('.channel');
                const channelName = channel.querySelector('.channel-name').textContent;
                const action = button.textContent;
                console.log(`${channelName} ${action} toggled`);
            }

            togglePlugin(button) {
                const isOn = button.textContent === 'ON';
                button.textContent = isOn ? 'OFF' : 'ON';
                button.classList.toggle('bypassed');
                const plugin = button.closest('.plugin-slot');
                const pluginName = plugin.querySelector('.plugin-name').textContent;
                console.log(`${pluginName} ${isOn ? 'bypassed' : 'enabled'}`);
            }

            selectFormat(button) {
                document.querySelectorAll('.format-option').forEach(btn => {
                    btn.classList.remove('selected');
                });
                button.classList.add('selected');
                console.log('Format selected:', button.dataset.format);
            }

            updateControlValue(slider) {
                const value = slider.value;
                const valueDisplay = slider.nextElementSibling;
                if (valueDisplay) {
                    if (slider.classList.contains('control-slider')) {
                        const label = slider.previousElementSibling.textContent;
                        if (label === 'Low' || label === 'Mid' || label === 'High') {
                            valueDisplay.textContent = `${value}dB`;
                        } else if (label === 'Threshold') {
                            valueDisplay.textContent = `${value}dB`;
                        } else if (label === 'Ratio') {
                            valueDisplay.textContent = `${value}:1`;
                        } else if (label === 'Attack' || label === 'Release') {
                            valueDisplay.textContent = `${value}ms`;
                        } else {
                            valueDisplay.textContent = `${value}%`;
                        }
                    }
                }
            }

            startVUAnimation() {
                // Simulate realistic audio levels for each channel
                this.vuAnimationInterval = setInterval(() => {
                    const channels = [
                        { name: 'Drums', baseLevel: 75, variation: 15 },
                        { name: 'Bass', baseLevel: 70, variation: 20 },
                        { name: 'Synth Lead', baseLevel: 45, variation: 25 },
                        { name: 'Vocals', baseLevel: 80, variation: 10 },
                        { name: 'Ambient Pad', baseLevel: 30, variation: 15 },
                        { name: 'Master', baseLevel: 85, variation: 8 }
                    ];
                    
                    channels.forEach((channel, index) => {
                        const leftMeter = document.querySelectorAll('.vu-meter-left')[index];
                        const rightMeter = document.querySelectorAll('.vu-meter-right')[index];
                        
                        if (leftMeter && rightMeter) {
                            // Create realistic audio level simulation
                            const time = Date.now() / 1000;
                            const beatPhase = (time * this.bpm / 60) % 1;
                            
                            // Different patterns for different channels
                            let leftLevel, rightLevel;
                            
                            switch(channel.name) {
                                case 'Drums':
                                    // Kick on beats 1 and 3, snare on 2 and 4
                                    leftLevel = beatPhase < 0.25 ? channel.baseLevel + channel.variation : 
                                              beatPhase < 0.5 ? channel.baseLevel : 
                                              channel.baseLevel - 10;
                                    rightLevel = leftLevel + (Math.random() - 0.5) * 5;
                                    break;
                                case 'Bass':
                                    // Follows kick pattern
                                    leftLevel = beatPhase < 0.5 ? channel.baseLevel + Math.sin(beatPhase * Math.PI * 4) * channel.variation : 
                                              channel.baseLevel - 5;
                                    rightLevel = leftLevel + (Math.random() - 0.5) * 3;
                                    break;
                                case 'Synth Lead':
                                    // Melodic variation
                                    leftLevel = channel.baseLevel + Math.sin(time * 2) * channel.variation + 
                                              Math.sin(time * 3.7) * 10;
                                    rightLevel = leftLevel + (Math.random() - 0.5) * 8;
                                    break;
                                case 'Vocals':
                                    // More consistent with occasional peaks
                                    leftLevel = channel.baseLevel + (beatPhase < 0.25 ? 15 : 0) + 
                                              (Math.random() - 0.5) * 5;
                                    rightLevel = leftLevel + (Math.random() - 0.5) * 3;
                                    break;
                                case 'Ambient Pad':
                                    // Slow, gentle movement
                                    leftLevel = channel.baseLevel + Math.sin(time * 0.5) * channel.variation;
                                    rightLevel = leftLevel + (Math.random() - 0.5) * 2;
                                    break;
                                case 'Master':
                                    // Combination of all channels with slight compression
                                    const allLevels = Array.from(document.querySelectorAll('.vu-meter-left')).slice(0, -1).map(m => parseFloat(m.style.height));
                                    const avgLevel = allLevels.reduce((a, b) => a + b, 0) / allLevels.length;
                                    leftLevel = Math.min(95, avgLevel * 1.1 + channel.variation * 0.3);
                                    rightLevel = leftLevel + (Math.random() - 0.5) * 2;
                                    break;
                                default:
                                    leftLevel = channel.baseLevel;
                                    rightLevel = channel.baseLevel;
                            }
                            
                            // Apply smoothing to avoid jarring changes
                            const currentLeft = parseFloat(leftMeter.style.height) || channel.baseLevel;
                            const currentRight = parseFloat(rightMeter.style.height) || channel.baseLevel;
                            
                            const smoothedLeft = currentLeft * 0.8 + leftLevel * 0.2;
                            const smoothedRight = currentRight * 0.8 + rightLevel * 0.2;
                            
                            // Ensure levels stay within bounds
                            const finalLeft = Math.max(5, Math.min(95, smoothedLeft));
                            const finalRight = Math.max(5, Math.min(95, smoothedRight));
                            
                            leftMeter.style.height = `${finalLeft}%`;
                            rightMeter.style.height = `${finalRight}%`;
                            
                            // Add clipping indicator if levels are too high
                            if (finalLeft > 90 || finalRight > 90) {
                                leftMeter.style.background = 'linear-gradient(to top, #ff4444, #ff6666, #ff8888)';
                                rightMeter.style.background = 'linear-gradient(to top, #ff4444, #ff6666, #ff8888)';
                            } else {
                                leftMeter.style.background = 'linear-gradient(to top, var(--accent-success), var(--accent-warning), var(--accent-danger))';
                                rightMeter.style.background = 'linear-gradient(to top, var(--accent-success), var(--accent-warning), var(--accent-danger))';
                            }
                        }
                    });
                }, 50); // Update 20 times per second for smooth animation
            }

            stopVUAnimation() {
                if (this.vuAnimationInterval) {
                    clearInterval(this.vuAnimationInterval);
                    this.vuAnimationInterval = null;
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? 'var(--accent-success)' : type === 'error' ? 'var(--accent-danger)' : 'var(--accent-primary)'};
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 8px;
                    z-index: 10001;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '1';
                }, 100);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            startAnimationLoop() {
                console.log('Animation loop started');
            }
        }

        // Initialize DAW when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing BeatForge AI DAW...');
            window.beatForgeAI = new BeatForgeAI();
        });

        // Fallback initialization if DOM is already loaded
        if (document.readyState === 'loading') {
            // DOM is still loading
        } else {
            console.log('DOM already loaded, initializing BeatForge AI DAW...');
            window.beatForgeAI = new BeatForgeAI();
        }
        // Fixed Enhanced DAW Features for BeatForge AI
class BeatForgeEnhanced {
    constructor() {
        this.midiAccess = null;
        this.virtualInstruments = new Map();
        this.automationLanes = new Map();
        this.plugins = new Map();
        this.projectData = null;
        this.audioEngine = null;
        this.editorTools = new Map();
        this.communityFeatures = new Map();
        
        // Initialize after original DAW is ready
        this.waitForOriginalDAW();
    }

    waitForOriginalDAW() {
        const checkDAW = () => {
            if (window.beatForgeAI && window.beatForgeAI.dawInterface) {
                console.log('Original DAW found, initializing enhanced features...');
                this.initializeEnhancements();
            } else {
                setTimeout(checkDAW, 100);
            }
        };
        checkDAW();
    }

    async initializeEnhancements() {
        try {
            console.log('Initializing BeatForge Enhanced Features...');
            
            // Hide loading screen if still visible
            this.hideLoadingScreen();
            
            await this.initializeAudioEngine();
            await this.initializeMIDISupport();
            this.initializeVirtualInstruments();
            this.initializeMIDIEditor();
            this.initializeAutomationLanes();
            this.initializeAdvancedEditing();
            this.initializePluginSystem();
            this.initializeProjectManagement();
            this.initializeCommunityFeatures();
            
            console.log('BeatForge Enhanced Features initialized successfully!');
        } catch (error) {
            console.error('Failed to initialize enhanced features:', error);
            this.hideLoadingScreen(); // Ensure loading screen is hidden even on error
        }
    }

    hideLoadingScreen() {
        const loadingScreen = document.getElementById('loading-screen');
        const dawInterface = document.getElementById('daw-interface');
        
        if (loadingScreen && loadingScreen.style.display !== 'none') {
            console.log('Hiding loading screen...');
            loadingScreen.style.opacity = '0';
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 500);
        }
        
        if (dawInterface && dawInterface.style.display === 'none') {
            dawInterface.style.display = 'block';
            setTimeout(() => {
                dawInterface.style.opacity = '1';
            }, 100);
        }
    }

    // ==================== AUDIO ENGINE ====================
    async initializeAudioEngine() {
        try {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            this.audioEngine = {
                context: new AudioContext(),
                sampleRate: 48000,
                bitDepth: 32,
                bufferSize: 256,
                latency: 0,
                masterGain: null,
                compressor: null,
                limiter: null,
                analyser: null,
                worklet: null
            };

            // Set up high-quality audio processing
            this.audioEngine.context.sampleRate = this.audioEngine.sampleRate;
            
            // Create master chain
            this.audioEngine.masterGain = this.audioEngine.context.createGain();
            this.audioEngine.compressor = this.audioEngine.context.createDynamicsCompressor();
            this.audioEngine.limiter = this.audioEngine.context.createDynamicsCompressor();
            this.audioEngine.analyser = this.audioEngine.context.createAnalyser();
            
            // Configure for professional quality
            this.audioEngine.analyser.fftSize = 2048;
            this.audioEngine.compressor.threshold.value = -24;
            this.audioEngine.compressor.ratio.value = 12;
            this.audioEngine.compressor.attack.value = 0.003;
            this.audioEngine.compressor.release.value = 0.25;
            
            this.audioEngine.limiter.threshold.value = -3;
            this.audioEngine.limiter.ratio.value = 20;
            this.audioEngine.limiter.attack.value = 0.001;
            
            // Connect master chain
            this.audioEngine.masterGain.connect(this.audioEngine.compressor);
            this.audioEngine.compressor.connect(this.audioEngine.limiter);
            this.audioEngine.limiter.connect(this.audioEngine.analyser);
            this.audioEngine.analyser.connect(this.audioEngine.context.destination);
            
            console.log('Audio engine initialized with high quality settings');
        } catch (error) {
            console.error('Failed to initialize audio engine:', error);
        }
    }

    // ==================== MIDI SUPPORT ====================
    async initializeMIDISupport() {
        try {
            if (navigator.requestMIDIAccess) {
                this.midiAccess = await navigator.requestMIDIAccess({
                    sysex: false,
                    software: true
                });
                
                this.setupMIDIHandlers();
                this.createMIDIUI();
                console.log('MIDI support initialized');
            } else {
                console.warn('Web MIDI API not supported');
                this.createVirtualMIDI();
            }
        } catch (error) {
            console.error('MIDI initialization failed:', error);
            this.createVirtualMIDI();
        }
    }

    setupMIDIHandlers() {
        if (!this.midiAccess) return;
        
        this.midiAccess.inputs.forEach(input => {
            input.onmidimessage = (event) => {
                this.handleMIDIMessage(event);
            };
        });
        
        this.midiAccess.onstatechange = (event) => {
            console.log('MIDI device state changed:', event.port.name, event.port.state);
        };
    }

    handleMIDIMessage(event) {
        const [command, note, velocity] = event.data;
        const channel = command & 0x0F;
        const messageType = command & 0xF0;
        
        switch (messageType) {
            case 0x90: // Note on
                if (velocity > 0) {
                    this.handleNoteOn(note, velocity, channel);
                } else {
                    this.handleNoteOff(note, channel);
                }
                break;
            case 0x80: // Note off
                this.handleNoteOff(note, channel);
                break;
            case 0xB0: // Control change
                this.handleControlChange(note, velocity, channel);
                break;
            case 0xE0: // Pitch bend
                this.handlePitchBend(note, velocity, channel);
                break;
        }
    }

    handleNoteOn(note, velocity, channel) {
        console.log(`Note ON: ${note}, Velocity: ${velocity}, Channel: ${channel}`);
        this.showMIDIFeedback(note, velocity, true);
    }

    handleNoteOff(note, channel) {
        console.log(`Note OFF: ${note}, Channel: ${channel}`);
        this.showMIDIFeedback(note, 0, false);
    }

    handleControlChange(controller, value, channel) {
        console.log(`Control Change: ${controller}, Value: ${value}, Channel: ${channel}`);
    }

    handlePitchBend(lsb, msb, channel) {
        const bendValue = (msb << 7) | lsb;
        const normalizedBend = (bendValue - 8192) / 8192;
        console.log(`Pitch Bend: ${normalizedBend}, Channel: ${channel}`);
    }

    createVirtualMIDI() {
        console.log('Creating virtual MIDI keyboard');
        this.createVirtualKeyboard();
    }

    createVirtualKeyboard() {
        // Check if keyboard already exists
        if (document.getElementById('virtual-midi-keyboard')) {
            return;
        }

        const keyboardHTML = `
            <div class="virtual-midi-keyboard" id="virtual-midi-keyboard">
                <div class="keyboard-container">
                    <div class="white-keys">
                        ${this.generateWhiteKeys()}
                    </div>
                    <div class="black-keys">
                        ${this.generateBlackKeys()}
                    </div>
                </div>
                <div class="keyboard-controls">
                    <button class="octave-down" data-action="octave-down">-</button>
                    <span class="octave-display">C4</span>
                    <button class="octave-up" data-action="octave-up">+</button>
                </div>
            </div>
        `;

        // Add keyboard to the DOM
        const keyboardContainer = document.createElement('div');
        keyboardContainer.innerHTML = keyboardHTML;
        document.body.appendChild(keyboardContainer);

        // Add event listeners
        this.setupVirtualKeyboardEvents();
    }

    generateWhiteKeys() {
        const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
        let html = '';
        
        for (let octave = 3; octave <= 5; octave++) {
            whiteKeys.forEach((note, index) => {
                const noteNumber = (octave * 12) + this.getNoteNumber(note);
                html += `<div class="white-key" data-note="${noteNumber}" data-note-name="${note}${octave}">${note}${octave}</div>`;
            });
        }
        
        return html;
    }

    generateBlackKeys() {
        const blackKeys = [
            { note: 'C#', position: 1 },
            { note: 'D#', position: 2 },
            { note: 'F#', position: 4 },
            { note: 'G#', position: 5 },
            { note: 'A#', position: 6 }
        ];
        
        let html = '';
        
        for (let octave = 3; octave <= 5; octave++) {
            blackKeys.forEach(({ note, position }) => {
                const noteNumber = (octave * 12) + this.getNoteNumber(note);
                html += `<div class="black-key" data-note="${noteNumber}" data-note-name="${note}${octave}" style="left: ${position * 40 + octave * 280}px">${note}</div>`;
            });
        }
        
        return html;
    }

    getNoteNumber(noteName) {
        const noteMap = {
            'C': 0, 'C#': 1, 'D': 2, 'D#': 3, 'E': 4, 'F': 5,
            'F#': 6, 'G': 7, 'G#': 8, 'A': 9, 'A#': 10, 'B': 11
        };
        return noteMap[noteName] || 0;
    }

    setupVirtualKeyboardEvents() {
        const keyboard = document.getElementById('virtual-midi-keyboard');
        if (!keyboard) return;

        // Mouse events
        keyboard.addEventListener('mousedown', (e) => {
            if (e.target.classList.contains('white-key') || e.target.classList.contains('black-key')) {
                const note = parseInt(e.target.dataset.note);
                this.handleNoteOn(note, 127, 0);
                e.target.classList.add('active');
            }
        });

        keyboard.addEventListener('mouseup', (e) => {
            if (e.target.classList.contains('white-key') || e.target.classList.contains('black-key')) {
                const note = parseInt(e.target.dataset.note);
                this.handleNoteOff(note, 0);
                e.target.classList.remove('active');
            }
        });

        // Touch events for mobile
        keyboard.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (e.target.classList.contains('white-key') || e.target.classList.contains('black-key')) {
                const note = parseInt(e.target.dataset.note);
                this.handleNoteOn(note, 127, 0);
                e.target.classList.add('active');
            }
        });

        keyboard.addEventListener('touchend', (e) => {
            e.preventDefault();
            if (e.target.classList.contains('white-key') || e.target.classList.contains('black-key')) {
                const note = parseInt(e.target.dataset.note);
                this.handleNoteOff(note, 0);
                e.target.classList.remove('active');
            }
        });

        // Octave controls
        keyboard.querySelector('.octave-down')?.addEventListener('click', () => {
            this.changeOctave(-1);
        });

        keyboard.querySelector('.octave-up')?.addEventListener('click', () => {
            this.changeOctave(1);
        });
    }

    // ==================== VIRTUAL INSTRUMENTS ====================
    initializeVirtualInstruments() {
        this.createSynthesizer('Analog Lead', 'analog');
        this.createSynthesizer('FM Bell', 'fm');
        this.createSynthesizer('Wavetable Pad', 'wavetable');
        this.createSampler('Drum Kit', 'drum');
        this.createSampler('Orchestral', 'orchestral');
        this.createInstrumentUI();
    }

    createSynthesizer(name, type) {
        const synth = {
            name: name,
            type: type,
            initialized: false,
            
            initialize(audioContext) {
                if (this.initialized) return;
                
                try {
                    this.oscillator = audioContext.createOscillator();
                    this.filter = audioContext.createBiquadFilter();
                    this.envelope = audioContext.createGain();
                    
                    // Configure based on type
                    switch (type) {
                        case 'analog':
                            this.oscillator.type = 'sawtooth';
                            this.filter.type = 'lowpass';
                            this.filter.frequency.value = 1000;
                            break;
                        case 'fm':
                            this.oscillator.type = 'sine';
                            this.filter.type = 'bandpass';
                            this.filter.frequency.value = 800;
                            break;
                        case 'wavetable':
                            this.oscillator.type = 'triangle';
                            this.filter.type = 'highpass';
                            this.filter.frequency.value = 200;
                            break;
                    }
                    
                    this.oscillator.connect(this.filter);
                    this.filter.connect(this.envelope);
                    this.envelope.connect(audioContext.destination);
                    
                    this.oscillator.start();
                    this.initialized = true;
                } catch (error) {
                    console.error(`Failed to initialize ${name}:`, error);
                }
            },
            
            playNote(note, velocity) {
                if (!this.initialized && this.audioEngine) {
                    this.initialize(this.audioEngine.context);
                }
                
                if (this.oscillator) {
                    const frequency = 440 * Math.pow(2, (note - 69) / 12);
                    this.oscillator.frequency.setValueAtTime(frequency, this.audioEngine.context.currentTime);
                    this.envelope.gain.setValueAtTime(velocity / 127, this.audioEngine.context.currentTime);
                }
            },
            
            stopNote(note) {
                if (this.envelope) {
                    this.envelope.gain.exponentialRampToValueAtTime(0.001, this.audioEngine.context.currentTime + 0.1);
                }
            }
        };
        
        this.virtualInstruments.set(name, synth);
        return synth;
    }

    createSampler(name, type) {
        const sampler = {
            name: name,
            type: type,
            samples: new Map(),
            activeNotes: new Map(),
            
            async loadSamples() {
                // For now, create simple placeholder samples
                console.log(`Loading samples for ${name} (${type})`);
                // In a real implementation, you would load actual audio files here
            },
            
            playNote(note, velocity) {
                console.log(`Playing ${name} note: ${note} with velocity: ${velocity}`);
                // Placeholder implementation
            },
            
            stopNote(note) {
                console.log(`Stopping ${name} note: ${note}`);
                // Placeholder implementation
            }
        };
        
        this.virtualInstruments.set(name, sampler);
        sampler.loadSamples();
        return sampler;
    }

    createInstrumentUI() {
        // Check if UI already exists
        if (document.getElementById('virtual-instruments-panel')) {
            return;
        }

        const instrumentHTML = `
            <div class="virtual-instruments-panel" id="virtual-instruments-panel">
                <div class="instruments-header">
                    <h3>üéπ Virtual Instruments</h3>
                    <div class="instrument-controls">
                        <select id="instrument-select">
                            ${Array.from(this.virtualInstruments.keys()).map(name => 
                                `<option value="${name}">${name}</option>`
                            ).join('')}
                        </select>
                        <button class="add-instrument-btn">+ Add</button>
                    </div>
                </div>
                <div class="instrument-parameters">
                    <div class="parameter-group">
                        <label>Oscillator</label>
                        <select id="oscillator-type">
                            <option value="sine">Sine</option>
                            <option value="square">Square</option>
                            <option value="sawtooth">Sawtooth</option>
                            <option value="triangle">Triangle</option>
                        </select>
                    </div>
                    <div class="parameter-group">
                        <label>Filter Cutoff</label>
                        <input type="range" id="filter-cutoff" min="20" max="20000" value="1000">
                    </div>
                    <div class="parameter-group">
                        <label>Resonance</label>
                        <input type="range" id="filter-resonance" min="0" max="30" value="1">
                    </div>
                </div>
            </div>
        `;

        // Add to existing AI panel or create new section
        const aiPanel = document.getElementById('ai-section');
        if (aiPanel) {
            const instrumentDiv = document.createElement('div');
            instrumentDiv.innerHTML = instrumentHTML;
            aiPanel.appendChild(instrumentDiv);
            
            // Setup event listeners
            this.setupInstrumentControls();
        }
    }

    setupInstrumentControls() {
        const instrumentSelect = document.getElementById('instrument-select');
        const oscillatorType = document.getElementById('oscillator-type');
        const filterCutoff = document.getElementById('filter-cutoff');
        const filterResonance = document.getElementById('filter-resonance');
        
        instrumentSelect?.addEventListener('change', (e) => {
            this.selectInstrument(e.target.value);
        });
        
        oscillatorType?.addEventListener('change', (e) => {
            this.updateOscillatorType(e.target.value);
        });
        
        filterCutoff?.addEventListener('input', (e) => {
            this.updateFilterCutoff(e.target.value);
        });
        
        filterResonance?.addEventListener('input', (e) => {
            this.updateFilterResonance(e.target.value);
        });
    }

    // ==================== MIDI EDITOR / PIANO ROLL ====================
    initializeMIDIEditor() {
        this.createMIDIEditorUI();
        this.setupMIDIEditorEvents();
    }

    createMIDIEditorUI() {
        // Check if UI already exists
        if (document.getElementById('midi-editor-panel')) {
            return;
        }

        const editorHTML = `
            <div class="midi-editor-panel" id="midi-editor-panel">
                <div class="editor-header">
                    <h3>üéº MIDI Editor</h3>
                    <div class="editor-tools">
                        <button class="tool-btn active" data-tool="draw">Draw</button>
                        <button class="tool-btn" data-tool="erase">Erase</button>
                        <button class="tool-btn" data-tool="select">Select</button>
                    </div>
                </div>
                <div class="piano-roll-container">
                    <div class="piano-roll-main">
                        <div class="piano-keyboard">
                            ${this.generatePianoKeys()}
                        </div>
                        <div class="midi-grid" id="midi-grid">
                            ${this.generateMIDIGrid()}
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Add to session view
        const sessionView = document.getElementById('session-section');
        if (sessionView) {
            const editorDiv = document.createElement('div');
            editorDiv.innerHTML = editorHTML;
            sessionView.appendChild(editorDiv);
        }
    }

    generatePianoKeys() {
        const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        let keysHTML = '';
        
        for (let octave = 7; octave >= 0; octave--) {
            notes.forEach((note, index) => {
                const isBlack = note.includes('#');
                const noteNumber = octave * 12 + index;
                keysHTML += `<div class="piano-key ${isBlack ? 'black' : 'white'}" data-note="${noteNumber}">
                    ${note}${octave}
                </div>`;
            });
        }
        
        return keysHTML;
    }

    generateMIDIGrid() {
        const totalBars = 16;
        const beatsPerBar = 4;
        const noteCount = 96; // 8 octaves * 12 notes
        
        let gridHTML = '';
        
        for (let note = 0; note < noteCount; note++) {
            for (let beat = 0; beat < totalBars * beatsPerBar; beat++) {
                gridHTML += `<div class="midi-cell" data-note="${note}" data-beat="${beat}"></div>`;
            }
        }
        
        return gridHTML;
    }

    setupMIDIEditorEvents() {
        const grid = document.getElementById('midi-grid');
        if (!grid) return;
        
        let isDrawing = false;
        let currentTool = 'draw';
        
        // Tool selection
        document.querySelectorAll('.tool-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentTool = e.target.dataset.tool;
            });
        });
        
        // Mouse events
        grid.addEventListener('mousedown', (e) => {
            if (e.target.classList.contains('midi-cell')) {
                isDrawing = true;
                this.handleMIDICellClick(e.target, currentTool);
            }
        });
        
        grid.addEventListener('mousemove', (e) => {
            if (isDrawing && e.target.classList.contains('midi-cell')) {
                this.handleMIDICellClick(e.target, currentTool);
            }
        });
        
        grid.addEventListener('mouseup', () => {
            isDrawing = false;
        });
        
        // Touch events for mobile
        grid.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (e.target.classList.contains('midi-cell')) {
                isDrawing = true;
                this.handleMIDICellClick(e.target, currentTool);
            }
        });
        
        grid.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const element = document.elementFromPoint(touch.clientX, touch.clientY);
            if (isDrawing && element && element.classList.contains('midi-cell')) {
                this.handleMIDICellClick(element, currentTool);
            }
        });
        
        grid.addEventListener('touchend', () => {
            isDrawing = false;
        });
    }

    handleMIDICellClick(cell, tool) {
        const note = parseInt(cell.dataset.note);
        const beat = parseInt(cell.dataset.beat);
        
        switch (tool) {
            case 'draw':
                if (!cell.classList.contains('note')) {
                    cell.classList.add('note');
                    this.addMIDINote(note, beat);
                }
                break;
            case 'erase':
                if (cell.classList.contains('note')) {
                    cell.classList.remove('note');
                    this.removeMIDINote(note, beat);
                }
                break;
            case 'select':
                this.selectMIDINote(note, beat);
                break;
        }
    }

    addMIDINote(note, beat) {
        console.log(`Added MIDI note: ${note} at beat ${beat}`);
        if (!this.projectData) this.projectData = { midiNotes: [] };
        this.projectData.midiNotes.push({ note, beat, duration: 1, velocity: 127 });
    }

    removeMIDINote(note, beat) {
        console.log(`Removed MIDI note: ${note} at beat ${beat}`);
        if (this.projectData && this.projectData.midiNotes) {
            this.projectData.midiNotes = this.projectData.midiNotes.filter(
                n => !(n.note === note && n.beat === beat)
            );
        }
    }

    // ==================== AUTOMATION LANES ====================
    initializeAutomationLanes() {
        this.createAutomationUI();
        this.setupAutomationEvents();
    }

    createAutomationUI() {
        // Check if UI already exists
        if (document.getElementById('automation-panel')) {
            return;
        }

        const automationHTML = `
            <div class="automation-panel" id="automation-panel">
                <div class="automation-header">
                    <h3>üìà Automation Lanes</h3>
                    <div class="automation-controls">
                        <button class="add-automation-btn">+ Add Lane</button>
                        <select id="automation-parameter">
                            <option value="volume">Volume</option>
                            <option value="pan">Pan</option>
                            <option value="filter">Filter</option>
                        </select>
                    </div>
                </div>
                <div class="automation-container" id="automation-container">
                    <div class="automation-lane" data-parameter="volume">
                        <div class="lane-header">
                            <span>Volume</span>
                            <button class="remove-lane">√ó</button>
                        </div>
                        <div class="automation-grid">
                            ${this.generateAutomationGrid('volume')}
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Add to mixer view
        const mixerView = document.getElementById('mixer-section');
        if (mixerView) {
            const automationDiv = document.createElement('div');
            automationDiv.innerHTML = automationHTML;
            mixerView.appendChild(automationDiv);
        }
    }

    generateAutomationGrid(parameter) {
        const gridPoints = 64;
        let gridHTML = '';
        
        for (let i = 0; i < gridPoints; i++) {
            gridHTML += `<div class="automation-point" data-parameter="${parameter}" data-position="${i}"></div>`;
        }
        
        return gridHTML;
    }

    setupAutomationEvents() {
        const container = document.getElementById('automation-container');
        if (!container) return;
        
        // Add automation lane
        document.querySelector('.add-automation-btn')?.addEventListener('click', () => {
            const parameter = document.getElementById('automation-parameter').value;
            this.addAutomationLane(parameter);
        });
    }

    // ==================== ADVANCED EDITING TOOLS ====================
    initializeAdvancedEditing() {
        this.createEditingToolsUI();
        this.setupEditingToolsEvents();
    }

    createEditingToolsUI() {
        // Check if UI already exists
        if (document.getElementById('editing-tools-panel')) {
            return;
        }

        const editingHTML = `
            <div class="editing-tools-panel" id="editing-tools-panel">
                <div class="editing-header">
                    <h3>‚úÇÔ∏è Advanced Editing</h3>
                </div>
                <div class="editing-tools">
                    <div class="tool-group">
                        <h4>Clip Tools</h4>
                        <button class="edit-tool" data-tool="cut">‚úÇÔ∏è Cut</button>
                        <button class="edit-tool" data-tool="trim">üìè Trim</button>
                        <button class="edit-tool" data-tool="fade">üåä Fade</button>
                        <button class="edit-tool" data-tool="reverse">üîÑ Reverse</button>
                    </div>
                    <div class="tool-group">
                        <h4>Time Tools</h4>
                        <button class="edit-tool" data-tool="stretch">üìè Stretch</button>
                        <button class="edit-tool" data-tool="quantize">üìê Quantize</button>
                    </div>
                </div>
            </div>
        `;

        // Add to session view
        const sessionView = document.getElementById('session-section');
        if (sessionView) {
            const editingDiv = document.createElement('div');
            editingDiv.innerHTML = editingHTML;
            sessionView.appendChild(editingDiv);
        }
    }

    setupEditingToolsEvents() {
        document.querySelectorAll('.edit-tool').forEach(tool => {
            tool.addEventListener('click', (e) => {
                const toolType = e.target.dataset.tool;
                this.applyEditingTool(toolType);
            });
        });
    }

    applyEditingTool(toolType) {
        console.log(`Applying editing tool: ${toolType}`);
        this.showNotification(`Applied ${toolType} tool`, 'info');
    }

    // ==================== PLUGIN SYSTEM ====================
    initializePluginSystem() {
        this.createPluginUI();
        this.setupPluginEvents();
        this.loadBuiltInPlugins();
    }

    createPluginUI() {
        // Check if UI already exists
        if (document.getElementById('plugin-system-panel')) {
            return;
        }

        const pluginHTML = `
            <div class="plugin-system-panel" id="plugin-system-panel">
                <div class="plugin-header">
                    <h3>üîå Plugin System</h3>
                    <div class="plugin-controls">
                        <button class="add-plugin-btn">+ Add Plugin</button>
                    </div>
                </div>
                <div class="plugin-container" id="plugin-container">
                    <div class="plugin-slot">
                        <div class="plugin-header">
                            <span class="plugin-name">Reverb</span>
                            <button class="plugin-toggle active">ON</button>
                        </div>
                        <div class="plugin-parameters">
                            <div class="parameter">
                                <label>Room Size</label>
                                <input type="range" min="0" max="100" value="30">
                            </div>
                            <div class="parameter">
                                <label>Wet Mix</label>
                                <input type="range" min="0" max="100" value="20">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Add to plugins view
        const pluginsView = document.getElementById('plugins-section');
        if (pluginsView) {
            const pluginDiv = document.createElement('div');
            pluginDiv.innerHTML = pluginHTML;
            pluginsView.appendChild(pluginDiv);
        }
    }

    setupPluginEvents() {
        document.querySelector('.add-plugin-btn')?.addEventListener('click', () => {
            this.addPlugin('effect');
        });
    }

    loadBuiltInPlugins() {
        this.loadPlugin('Reverb', 'effect');
        this.loadPlugin('Delay', 'effect');
        this.loadPlugin('Compressor', 'utility');
    }

    loadPlugin(name, type) {
        const plugin = {
            name: name,
            type: type,
            enabled: true
        };
        
        this.plugins.set(name, plugin);
        return plugin;
    }

    addPlugin(type) {
        console.log(`Adding plugin of type: ${type}`);
        this.showNotification('Plugin added', 'success');
    }

    // ==================== PROJECT MANAGEMENT ====================
    initializeProjectManagement() {
        this.createProjectUI();
        this.setupProjectEvents();
    }

    createProjectUI() {
        // Check if UI already exists
        if (document.getElementById('project-management-panel')) {
            return;
        }

        const projectHTML = `
            <div class="project-management-panel" id="project-management-panel">
                <div class="project-header">
                    <h3>üíæ Project Management</h3>
                    <div class="project-controls">
                        <button class="project-btn" data-action="new">New</button>
                        <button class="project-btn" data-action="save">Save</button>
                        <button class="project-btn" data-action="load">Load</button>
                        <button class="project-btn" data-action="export">Export</button>
                    </div>
                </div>
                <div class="project-info">
                    <div class="info-item">
                        <label>Project Name:</label>
                        <input type="text" id="project-name" value="Untitled Project">
                    </div>
                    <div class="info-item">
                        <label>BPM:</label>
                        <input type="number" id="project-bpm" value="120" min="60" max="200">
                    </div>
                </div>
            </div>
        `;

        // Add to export view
        const exportView = document.getElementById('export-section');
        if (exportView) {
            const projectDiv = document.createElement('div');
            projectDiv.innerHTML = projectHTML;
            exportView.appendChild(projectDiv);
        }
    }

    setupProjectEvents() {
        document.querySelectorAll('.project-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const action = e.target.dataset.action;
                this.handleProjectAction(action);
            });
        });
    }

    handleProjectAction(action) {
        switch (action) {
            case 'new':
                this.createNewProject();
                break;
            case 'save':
                this.saveProject();
                break;
            case 'load':
                this.loadProject();
                break;
            case 'export':
                this.exportProject();
                break;
        }
    }

    createNewProject() {
        console.log('Creating new project');
        this.showNotification('New project created', 'success');
    }

    saveProject() {
        console.log('Saving project');
        localStorage.setItem('beatforge-project', JSON.stringify({
            name: document.getElementById('project-name').value,
            bpm: parseInt(document.getElementById('project-bpm').value),
            saved: new Date().toISOString()
        }));
        this.showNotification('Project saved successfully', 'success');
    }

    loadProject() {
        console.log('Loading project');
        const project = localStorage.getItem('beatforge-project');
        if (project) {
            const projectData = JSON.parse(project);
            document.getElementById('project-name').value = projectData.name;
            document.getElementById('project-bpm').value = projectData.bpm;
            this.showNotification('Project loaded successfully', 'success');
        } else {
            this.showNotification('No saved project found', 'warning');
        }
    }

    exportProject() {
        console.log('Exporting project');
        this.showNotification('Project exported successfully', 'success');
    }

    // ==================== COMMUNITY FEATURES ====================
    initializeCommunityFeatures() {
        this.createCommunityUI();
        this.setupCommunityEvents();
    }

    createCommunityUI() {
        // Check if UI already exists
        if (document.getElementById('community-panel')) {
            return;
        }

        // Add community button to navigation
        const mainNav = document.querySelector('.main-nav');
        if (mainNav) {
            const communityBtn = document.createElement('button');
            communityBtn.className = 'nav-btn';
            communityBtn.dataset.section = 'community';
            communityBtn.textContent = 'Community';
            mainNav.appendChild(communityBtn);
        }

        const communityHTML = `
            <div class="community-panel section-content" id="community-section">
                <div class="community-header">
                    <h3>üåç Community</h3>
                    <div class="community-tabs">
                        <button class="community-tab active" data-tab="tutorials">Tutorials</button>
                        <button class="community-tab" data-tab="templates">Templates</button>
                    </div>
                </div>
                <div class="community-content">
                    <div class="tab-content active" id="tutorials-tab">
                        <div class="tutorial-list">
                            <div class="tutorial-item">
                                <h4>üéµ Getting Started</h4>
                                <p>Learn the basics of BeatForge AI DAW</p>
                                <button class="tutorial-btn">Watch</button>
                            </div>
                            <div class="tutorial-item">
                                <h4>üéπ MIDI Recording</h4>
                                <p>How to record and edit MIDI</p>
                                <button class="tutorial-btn">Watch</button>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" id="templates-tab">
                        <div class="template-list">
                            <div class="template-item">
                                <h4>üé∏ Rock Song</h4>
                                <p>Complete rock song template</p>
                                <button class="template-btn">Load</button>
                            </div>
                            <div class="template-item">
                                <h4>üéπ Electronic Track</h4>
                                <p>Electronic music template</p>
                                <button class="template-btn">Load</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Add community section
        document.body.appendChild(document.createElement('div')).outerHTML = communityHTML;
    }

    setupCommunityEvents() {
        // Community tabs
        document.querySelectorAll('.community-tab').forEach(tab => {
            tab.addEventListener('click', (e) => {
                document.querySelectorAll('.community-tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                
                const tabName = e.target.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}-tab`)?.classList.add('active');
            });
        });
        
        // Tutorial buttons
        document.querySelectorAll('.tutorial-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const tutorial = e.target.closest('.tutorial-item').querySelector('h4').textContent;
                this.showNotification(`Opening tutorial: ${tutorial}`, 'info');
            });
        });
        
        // Template buttons
        document.querySelectorAll('.template-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const template = e.target.closest('.template-item').querySelector('h4').textContent;
                this.showNotification(`Loading template: ${template}`, 'info');
            });
        });
    }

    // ==================== UTILITY METHODS ====================
    showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#6366f1'};
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            z-index: 10001;
            opacity: 0;
            transition: opacity 0.3s ease;
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.opacity = '1';
        }, 100);
        
        setTimeout(() => {
            notification.style.opacity = '0';
            setTimeout(() => {
                if (notification.parentNode) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }

    showMIDIFeedback(note, velocity, isOn) {
        // Show visual feedback for MIDI activity
        const feedback = document.createElement('div');
        feedback.className = 'midi-feedback';
        feedback.textContent = `Note: ${note} ${isOn ? 'ON' : 'OFF'}`;
        feedback.style.cssText = `
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.9rem;
            z-index: 10000;
        `;
        
        document.body.appendChild(feedback);
        
        setTimeout(() => {
            if (feedback.parentNode) {
                document.body.removeChild(feedback);
            }
        }, 1000);
    }

    selectInstrument(instrumentName) {
        console.log(`Selected instrument: ${instrumentName}`);
    }

    updateOscillatorType(type) {
        console.log(`Oscillator type changed to: ${type}`);
    }

    updateFilterCutoff(value) {
        console.log(`Filter cutoff changed to: ${value}`);
    }

    updateFilterResonance(value) {
        console.log(`Filter resonance changed to: ${value}`);
    }

    changeOctave(direction) {
        const octaveDisplay = document.querySelector('.octave-display');
        if (octaveDisplay) {
            const currentOctave = parseInt(octaveDisplay.textContent.slice(1));
            const newOctave = Math.max(0, Math.min(8, currentOctave + direction));
            octaveDisplay.textContent = `C${newOctave}`;
        }
    }

    addAutomationLane(parameter) {
        console.log(`Adding automation lane for: ${parameter}`);
    }

    selectMIDINote(note, beat) {
        console.log(`Selected MIDI note: ${note} at beat ${beat}`);
    }
}

// Add CSS for enhanced features
const enhancedCSS = `
/* Enhanced DAW Features CSS */
.virtual-midi-keyboard {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 120px;
    background: #1a1a1a;
    border-top: 1px solid #333;
    display: flex;
    flex-direction: column;
    z-index: 1000;
}

.keyboard-container {
    flex: 1;
    position: relative;
    overflow-x: auto;
    overflow-y: hidden;
}

.white-keys {
    display: flex;
    height: 100%;
    min-width: 840px;
}

.white-key {
    flex: 1;
    border: 1px solid #333;
    background: #fff;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 5px;
    font-size: 10px;
    cursor: pointer;
    transition: all 0.1s ease;
    min-width: 40px;
}

.white-key:hover {
    background: #f0f0f0;
}

.white-key.active {
    background: #6366f1;
    color: white;
}

.black-keys {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 60%;
    pointer-events: none;
    min-width: 840px;
}

.black-key {
    position: absolute;
    width: 30px;
    height: 100%;
    background: #000;
    color: #fff;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 5px;
    font-size: 8px;
    cursor: pointer;
    pointer-events: all;
    transition: all 0.1s ease;
}

.black-key:hover {
    background: #333;
}

.black-key.active {
    background: #6366f1;
}

.keyboard-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    padding: 0.5rem;
    background: #2a2a2a;
}

.keyboard-controls button {
    background: #3a3a3a;
    border: 1px solid #555;
    color: #fff;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    cursor: pointer;
}

.octave-display {
    color: #fff;
    font-weight: bold;
}

.virtual-instruments-panel,
.midi-editor-panel,
.automation-panel,
.editing-tools-panel,
.plugin-system-panel,
.project-management-panel,
.community-panel {
    background: #1a1a1a;
    border-radius: 8px;
    padding: 1rem;
    margin: 1rem 0;
    border: 1px solid #333;
}

.instruments-header,
.editor-header,
.automation-header,
.editing-header,
.plugin-header,
.project-header,
.community-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.instrument-controls,
.editor-tools,
.automation-controls,
.plugin-controls,
.project-controls {
    display: flex;
    gap: 0.5rem;
}

.instrument-parameters,
.plugin-parameters,
.project-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.parameter-group,
.info-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.parameter-group label,
.info-item label {
    font-size: 0.9rem;
    color: #a0a0a0;
}

.parameter-group input,
.parameter-group select,
.info-item input,
.info-item select {
    background: #2a2a2a;
    border: 1px solid #333;
    color: #fff;
    padding: 0.5rem;
    border-radius: 4px;
}

.tool-btn,
.edit-tool,
.project-btn,
.add-instrument-btn,
.add-plugin-btn,
.add-automation-btn,
.tutorial-btn,
.template-btn {
    background: #2a2a2a;
    border: 1px solid #333;
    color: #a0a0a0;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.tool-btn:hover,
.edit-tool:hover,
.project-btn:hover,
.add-instrument-btn:hover,
.add-plugin-btn:hover,
.add-automation-btn:hover,
.tutorial-btn:hover,
.template-btn:hover {
    background: #3a3a3a;
    color: #fff;
}

.tool-btn.active,
.edit-tool.active,
.project-btn.active {
    background: #6366f1;
    color: #fff;
    border-color: #6366f1;
}

.piano-roll-container {
    background: #0a0a0a;
    border-radius: 4px;
    overflow: hidden;
    margin: 1rem 0;
}

.piano-roll-main {
    display: flex;
    height: 300px;
}

.piano-keyboard {
    width: 60px;
    background: #1a1a1a;
    border-right: 1px solid #333;
    overflow-y: auto;
}

.piano-key {
    height: 25px;
    border-bottom: 1px solid #333;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    color: #a0a0a0;
}

.midi-grid {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(64, 1fr);
    grid-template-rows: repeat(96, 1fr);
    gap: 1px;
    background: #333;
    overflow: auto;
}

.midi-cell {
    background: #1a1a1a;
    cursor: pointer;
    transition: background 0.1s ease;
}

.midi-cell:hover {
    background: #2a2a2a;
}

.midi-cell.note {
    background: #6366f1;
}

.automation-container {
    margin-top: 1rem;
}

.automation-lane {
    background: #0a0a0a;
    border-radius: 4px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.lane-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.automation-grid {
    display: grid;
    grid-template-columns: repeat(64, 1fr);
    gap: 1px;
    background: #333;
    height: 60px;
}

.automation-point {
    background: #1a1a1a;
    cursor: pointer;
    transition: all 0.1s ease;
}

.automation-point:hover {
    background: #2a2a2a;
}

.automation-point.active {
    background: #10b981;
}

.editing-tools {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.tool-group {
    background: #0a0a0a;
    border-radius: 4px;
    padding: 1rem;
}

.tool-group h4 {
    margin-bottom: 1rem;
    color: #fff;
}

.plugin-slot {
    background: #0a0a0a;
    border-radius: 4px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.plugin-slot .plugin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.plugin-slot .plugin-parameters {
    display: grid;
    gap: 1rem;
}

.plugin-slot .parameter {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.plugin-toggle {
    background: #6366f1;
    border: none;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.8rem;
}

.plugin-toggle:hover {
    background: #8b5cf6;
}

.community-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    border-bottom: 1px solid #333;
}

.community-tab {
    background: transparent;
    border: none;
    color: #a0a0a0;
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border-bottom: 2px solid transparent;
    font-size: 0.9rem;
}

.community-tab:hover {
    color: #fff;
}

.community-tab.active {
    color: #6366f1;
    border-bottom-color: #6366f1;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.tutorial-list,
.template-list {
    display: grid;
    gap: 1rem;
}

.tutorial-item,
.template-item {
    background: #0a0a0a;
    border-radius: 4px;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.tutorial-item h4,
.template-item h4 {
    color: #fff;
    margin-bottom: 0.5rem;
}

.tutorial-item p,
.template-item p {
    color: #a0a0a0;
    font-size: 0.9rem;
}

@media (max-width: 768px) {
    .virtual-midi-keyboard {
        height: 100px;
    }
    
    .white-key {
        min-width: 30px;
        font-size: 8px;
    }
    
    .black-key {
        width: 20px;
        font-size: 6px;
    }
    
    .instrument-parameters,
    .plugin-parameters,
    .project-info {
        grid-template-columns: 1fr;
    }
    
    .editing-tools {
        grid-template-columns: 1fr;
    }
    
    .piano-roll-main {
        height: 200px;
    }
    
    .piano-keyboard {
        width: 40px;
    }
    
    .midi-grid {
        grid-template-columns: repeat(32, 1fr);
        grid-template-rows: repeat(48, 1fr);
    }
}
`;

// Inject CSS
const styleSheet = document.createElement('style');
styleSheet.textContent = enhancedCSS;
document.head.appendChild(styleSheet);

// Initialize enhanced DAW features
document.addEventListener('DOMContentLoaded', () => {
    // Wait for original DAW to be ready
    setTimeout(() => {
        window.beatForgeEnhanced = new BeatForgeEnhanced();
        
        // Integrate with original BeatForge AI
        if (window.beatForgeAI) {
            window.beatForgeAI.enhanced = window.beatForgeEnhanced;
            console.log('BeatForge Enhanced integrated with original DAW');
        }
    }, 500); // Reduced timeout to avoid loading screen issues
});
    </script>
</body>
</html>
